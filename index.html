<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DU DOCES — Distribuidora</title>

  <!-- SEO -->
  <link rel="canonical" href="https://du-doces.vercel.app/">
  <meta name="description" content="Du Doces Distribuidora — bebidas, chocolates, salgadinhos e mais com entrega rápida." />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#C62828" />

  <!-- OG -->
  <meta property="og:site_name" content="DU DOCES" />
  <meta property="og:title" content="DU DOCES — Distribuidora" />
  <meta property="og:description" content="As melhores marcas com logística ágil." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://du-doces.vercel.app/" />

  <style>
    :root{
      --brand:#C62828;
      --brand-600:#b02121;
      --bg:#ffffff;
      --fg:#1f1f1f;
      --muted:#666;
      --card:#ffffff;
      --chip:#f6f6f6;
      --border:#e9e9e9;
      --success:#10b981;
      --danger:#ef4444;
    }
    .dark{
      --bg:#0e0e10;
      --fg:#f2f2f2;
      --muted:#b9b9b9;
      --card:#151517;
      --chip:#1d1d21;
      --border:#2a2a2e;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";}

    /* Header */
    header{
      position:sticky; top:0; z-index:50;
      background:var(--bg); border-bottom:1px solid var(--border);
      backdrop-filter:saturate(150%) blur(6px);
    }
    .topbar{
      max-width:1100px; margin:0 auto; padding:10px 16px;
      display:grid; grid-template-columns:1fr auto 1fr; align-items:center; gap:12px;
    }
    .logo{
      text-align:center; font-weight:900; letter-spacing:1px; user-select:none;
      font-size:24px; color:var(--brand);
    }
    .logo span{ color:var(--fg); font-weight:800; }
    .left-actions, .right-actions{display:flex;align-items:center;gap:10px}
    .btn{
      appearance:none; border:1px solid var(--border); background:var(--chip);
      color:var(--fg); padding:10px 14px; border-radius:12px; font-weight:600; cursor:pointer;
      transition:.2s transform,.2s background;
    }
    .btn:hover{ transform:translateY(-1px)}
    .btn.primary{ background:var(--brand); color:#fff; border-color:var(--brand)}
    .btn.danger{ background:var(--danger); color:#fff; border-color:var(--danger)}
    .iconbtn{
      display:flex;align-items:center;justify-content:center;gap:8px;
      height:42px; padding:0 12px; border-radius:12px; border:1px solid var(--border);
      background:var(--chip); cursor:pointer; font-weight:600;
    }
    .icon{width:20px;height:20px;display:inline-block}

    /* Sticky categories */
    .categories-wrap{
      position:sticky; top:58px; z-index:40;
      background:var(--bg); border-bottom:1px solid var(--border);
    }
    .categories{
      max-width:1100px; margin:0 auto; padding:8px 16px; display:flex; gap:8px; overflow:auto;
      scrollbar-width:thin;
    }
    .chip{
      white-space:nowrap; background:var(--chip); border:1px solid var(--border);
      padding:8px 12px; border-radius:999px; font-weight:600; cursor:pointer; user-select:none;
      transition:.2s background;
    }
    .chip.active, .chip:hover{ background:var(--brand); border-color:var(--brand); color:#fff}

    main{max-width:1100px;margin:18px auto;padding:0 16px;display:flex;flex-direction:column;gap:28px}

    /* Marcas principais */
    .brands{ display:grid;grid-template-columns:repeat(6,1fr); gap:12px; }
    @media (max-width:900px){ .brands{grid-template-columns:repeat(3,1fr)} }
    @media (max-width:520px){ .brands{grid-template-columns:repeat(2,1fr)} }
    .brand-card{
      background:var(--card); border:1px solid var(--border); border-radius:16px; padding:14px;
      display:flex;align-items:center;justify-content:center; height:82px; font-weight:800;
      cursor:pointer; transition:.2s transform,.2s border-color;
    }
    .brand-card:hover{ transform:translateY(-2px); border-color:var(--brand) }
    .brand-card.active{ outline:2px solid var(--brand); }

    /* Barra de ações da seção */
    .actions{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap;
      margin:6px 0 12px 0;
    }
    .hint{font-size:12px; color:var(--muted)}

    /* Produtos */
    .section h2{margin:0 0 6px 0; font-size:22px}
    .grid{ display:grid; grid-template-columns:repeat(5,1fr); gap:14px; }
    @media (max-width:1100px){ .grid{grid-template-columns:repeat(4,1fr)} }
    @media (max-width:900px){ .grid{grid-template-columns:repeat(3,1fr)} }
    @media (max-width:600px){ .grid{grid-template-columns:repeat(2,1fr)} }

    .card{ background:var(--card); border:1px solid var(--border); border-radius:16px; overflow:hidden; display:flex; flex-direction:column; }
    .thumb{ aspect-ratio:1/1; background:#fafafa; display:flex;align-items:center;justify-content:center; font-size:12px; color:var(--muted); position:relative }
    .badge{ position:absolute; left:0; top:0; background:var(--brand); color:#fff; padding:4px 8px; border-bottom-right-radius:12px; font-size:12px; font-weight:800; }
    .card-body{ padding:10px; display:flex; gap:8px; flex-direction:column; position:relative }
    .name{ font-weight:700; line-height:1.3; min-height:38px }
    .meta{ font-size:12px; color:var(--muted) }
    .price{ font-weight:800; color:var(--brand)}
    .unit{ font-size:12px; color:var(--muted)}
    .row{ display:flex; gap:8px; align-items:center; justify-content:space-between }
    .qty{ display:flex; gap:6px; align-items:center }
    .qty button{ width:28px; height:28px; border-radius:8px; background:var(--chip); border:1px solid var(--border); cursor:pointer }

    /* Drawer genérico */
    .drawer{ position:fixed; inset:0; z-index:60; display:none; }
    .drawer.open{ display:block }
    .drawer .backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.4) }
    .drawer .panel{ position:absolute; top:0; right:0; width:min(92vw,380px); height:100%; background:var(--card);
      border-left:1px solid var(--border); padding:18px; display:flex; flex-direction:column; gap:12px; }

    .drawer h3{ margin:0 0 8px 0 }
    .drawer .list a{ display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px; text-decoration:none; color:var(--fg); border:1px solid var(--border); background:var(--chip) }

    /* Cart list */
    .cart-empty{ border:1px solid var(--border); border-radius:12px; padding:14px; text-align:center; color:var(--muted) }
    .cart-item{ display:grid; grid-template-columns:auto 1fr auto; gap:10px; align-items:center; border-bottom:1px solid var(--border); padding:10px 0; }
    .cart-name{ font-weight:700; }
    .cart-meta{ font-size:12px; color:var(--muted) }
    .cart-controls{ display:flex; gap:6px; align-items:center }
    .cart-controls button{ width:28px; height:28px; border-radius:8px; background:var(--chip); border:1px solid var(--border); cursor:pointer }
    .cart-row{ display:flex; justify-content:space-between; align-items:center; }
    .subtotal{ font-size:18px; font-weight:900 }

    /* Footer */
    footer{ margin-top:40px; border-top:1px solid var(--border); padding:20px; text-align:center; color:var(--muted)}
    a{color:inherit}
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div class="left-actions">
        <button id="btn-menu" class="iconbtn" aria-label="Abrir menu" title="Menu">
          <span class="icon">☰</span>
          <span>Menu</span>
        </button>
      </div>

      <div class="logo" aria-label="DU DOCES — Distribuidora">
        DU <span>DOCES</span>
      </div>

      <div class="right-actions">
        <input id="cep" type="text" placeholder="CEP" inputmode="numeric" maxlength="9" class="btn" style="width:120px" />
        <button id="btn-cart" class="iconbtn" title="Carrinho">
          <span class="icon">🛒</span><span>Carrinho</span>
          <span id="cartCount" class="hint" style="margin-left:4px;"></span>
        </button>
      </div>
    </div>

    <div class="categories-wrap">
      <nav class="categories" id="categories">
        <button class="chip" data-cat="bebidas">Bebidas</button>
        <button class="chip" data-cat="chiclete">Chiclete</button>
        <button class="chip" data-cat="bala">Bala</button>
        <button class="chip" data-cat="chocolate">Chocolate</button>
        <button class="chip" data-cat="bolacha">Bolacha/Biscoito</button>
        <button class="chip" data-cat="salgadinho">Salgadinhos</button>
        <button class="chip" data-cat="utilidades">Utilidades</button>
      </nav>
    </div>
  </header>

  <main>
    <!-- Marcas principais (SEPARADAS das categorias) -->
    <section class="section" id="marcas">
      <h2>Marcas Principais</h2>
      <div class="brands" id="brands">
        <div class="brand-card" data-brand="Coca-Cola">Coca-Cola</div>
        <div class="brand-card" data-brand="Tang">Tang</div>
        <div class="brand-card" data-brand="Arcor">Arcor</div>
        <div class="brand-card" data-brand="Santa Helena">Santa Helena</div>
        <div class="brand-card" data-brand="OZ">OZ</div>
        <div class="brand-card" data-brand="Nestlé">Nestlé</div>
        <div class="brand-card" data-brand="Lacta">Lacta</div>
        <div class="brand-card" data-brand="BALY">BALY</div>
        <div class="brand-card" data-brand="Fabitos">Fabitos</div>
        <div class="brand-card" data-brand="LA">LA</div>
        <div class="brand-card" data-brand="ThreeBond">ThreeBond</div>
        <div class="brand-card" data-brand="SuperBond">SuperBond</div>
      </div>
      <div class="hint">Clique em uma marca para filtrar. <a href="#" id="clearBrand">Limpar filtro</a></div>
    </section>

    <!-- Produtos -->
    <section class="section">
      <h2 id="titulo-categoria">Produtos</h2>
      <div class="actions">
        <button id="btn-cheapest-cat" class="btn">Mais barato da categoria</button>
        <button id="btn-cheapest-pacoca" class="btn">Paçoca mais barata</button>
        <button id="btn-cheapest-global" class="btn">Item mais barato geral</button>
        <select id="sort" class="btn">
          <option value="none">Ordenar</option>
          <option value="price_asc">Preço ↑</option>
          <option value="price_desc">Preço ↓</option>
          <option value="name_asc">Nome A-Z</option>
        </select>
        <span id="result" class="hint"></span>
      </div>
      <div class="grid" id="grid">
        <!-- Cards gerados via JS -->
      </div>
    </section>
  </main>

  <footer>
    © <span id="year"></span> DU DOCES — Distribuidora • Feito com ❤️
  </footer>

  <!-- Drawer Menu (3 barras) -->
  <div class="drawer" id="drawerMenu">
    <div class="backdrop" data-close></div>
    <aside class="panel">
      <div class="cart-row">
        <h3>Opções</h3>
        <button class="btn" data-close>Fechar</button>
      </div>
      <div class="list">
        <a href="#" id="sobre">Sobre nós</a>
        <a href="#" id="contato">Contato</a>
        <a href="#" id="toggle-dark">Modo escuro</a>
        <a href="#" id="abrir-chat">Atendimento por IA</a>
      </div>
    </aside>
  </div>

  <!-- Drawer Carrinho -->
  <div class="drawer" id="drawerCart">
    <div class="backdrop" data-close></div>
    <aside class="panel">
      <div class="cart-row">
        <h3>Seu carrinho</h3>
        <button class="btn" data-close>Fechar</button>
      </div>
      <div id="cartList"></div>
      <div class="cart-row">
        <div class="subtotal">Subtotal: R$ <span id="subtotal">0,00</span></div>
        <button id="clearCart" class="btn danger">Limpar</button>
      </div>
      <button id="checkout" class="btn primary" style="width:100%;height:44px;">Finalizar pedido</button>
      <div class="hint">* Valores e disponibilidade podem variar. Frete calculado pelo CEP.</div>
    </aside>
  </div>

  <!-- ChatVolt Bubble -->
  <script type="module">
    import Chatbox from 'https://cdn.jsdelivr.net/npm/@chatvolt/embeds@latest/dist/chatbox/index.js';
    (async () => {
      try {
        const widget = await Chatbox.initBubble({
          agentId: 'cmfk2a6ko0w5htglbf0n10833',
          interface: {
            initialMessages: [
              'Olá! Posso ajudar com produtos, preços e sugestões de fardos.',
              'Quer saber a paçoca mais barata ou o item mais barato da loja?'
            ],
          },
          context: 'Atenda em PT-BR para a loja Du Doces Distribuidora. Responda sobre produtos, preços, marcas, frete por CEP, qual a paçoca mais barata, item mais barato e ajuda para comprar fardos de pipoca.',
        });

        window.toggleChat = () => widget.toggle();
        document.getElementById('abrir-chat')?.addEventListener('click', (e)=>{
          e.preventDefault();
          widget.open();
          document.getElementById('drawerMenu')?.classList.remove('open');
        });

        if (!sessionStorage.getItem('du_doces_chat_opened')) {
          setTimeout(() => {
            widget.open();
            sessionStorage.setItem('du_doces_chat_opened', '1');
          }, 800);
        }
      } catch (e) {
        console.error('Falha ao iniciar ChatVolt:', e);
      }
    })();
  </script>

  <!-- Funcionalidades da página -->
  <script>
    // Ano no rodapé
    document.getElementById('year').textContent = new Date().getFullYear();

    // ===== MENU drawer
    const drawerMenu = document.getElementById('drawerMenu');
    document.getElementById('btn-menu').addEventListener('click', ()=> drawerMenu.classList.add('open'));
    drawerMenu.querySelectorAll('[data-close]').forEach(el=> el.addEventListener('click', ()=> drawerMenu.classList.remove('open')));

    // ===== CARRINHO drawer
    const drawerCart = document.getElementById('drawerCart');
    document.getElementById('btn-cart').addEventListener('click', ()=> drawerCart.classList.add('open'));
    drawerCart.querySelectorAll('[data-close]').forEach(el=> el.addEventListener('click', ()=> drawerCart.classList.remove('open')));

    // ===== Modo escuro
    const toggleDark = document.getElementById('toggle-dark');
    const applyTheme = () => {
      const theme = localStorage.getItem('du_theme') || 'light';
      document.documentElement.classList.toggle('dark', theme === 'dark');
    };
    applyTheme();
    toggleDark?.addEventListener('click', (e)=>{
      e.preventDefault();
      const current = localStorage.getItem('du_theme') || 'light';
      const next = current === 'light' ? 'dark' : 'light';
      localStorage.setItem('du_theme', next);
      applyTheme();
    });

    // ================== DADOS REAIS – DU DOCES ==================
    const PRODUCTS = [
      // Águas (Bebidas)
      {id:101, name:'Água LA 510ml', brand:'LA', price:0.75, cat:'bebidas', size:'510ml', unitType:'unidade'},
      {id:102, name:'Água LA 510ml (Fardo c/12)', brand:'LA', price:9.00, cat:'bebidas', size:'510ml', unitType:'fardo', packQty:12},

      // Colas (Utilidades)
      {id:201, name:'ThreeBond Cola', brand:'ThreeBond', price:1.99, cat:'utilidades', unitType:'unidade'},
      {id:202, name:'SuperBond Cola', brand:'SuperBond', price:4.95, cat:'utilidades', unitType:'unidade'},

      // Pipocas OZ (Salgadinhos)
      {id:301, name:'Pipoca OZ 40g Doce', brand:'OZ', flavor:'Doce', size:'40g', price:0.70, cat:'salgadinho', unitType:'unidade'},
      {id:302, name:'Pipoca OZ 40g Salgada', brand:'OZ', flavor:'Salgada', size:'40g', price:0.70, cat:'salgadinho', unitType:'unidade'},
      {id:303, name:'Pipoca OZ 40g Doce (Fardo c/30)', brand:'OZ', flavor:'Doce', size:'40g', price:21.00, cat:'salgadinho', unitType:'fardo', packQty:30},
      {id:304, name:'Pipoca OZ 40g Salgada (Fardo c/30)', brand:'OZ', flavor:'Salgada', size:'40g', price:21.00, cat:'salgadinho', unitType:'fardo', packQty:30},
      {id:305, name:'Pipoca OZ 12g Doce (Cx c/50)', brand:'OZ', flavor:'Doce', size:'12g', price:16.50, cat:'salgadinho', unitType:'fardo', packQty:50},

      // Refrigerantes Coca / Fanta (Bebidas)
      {id:401, name:'Coca-Cola 350ml lata', brand:'Coca-Cola', size:'350ml', price:3.25, cat:'bebidas', unitType:'unidade'},
      {id:402, name:'Coca-Cola 200ml PET', brand:'Coca-Cola', size:'200ml', price:1.65, cat:'bebidas', unitType:'unidade'},
      {id:403, name:'Coca-Cola Zero 200ml PET', brand:'Coca-Cola', size:'200ml', flavor:'Zero', price:1.65, cat:'bebidas', unitType:'unidade'},
      {id:404, name:'Coca-Cola 200ml PET (Fardo c/12)', brand:'Coca-Cola', size:'200ml', price:19.80, cat:'bebidas', unitType:'fardo', packQty:12},
      {id:405, name:'Coca-Cola Zero 200ml PET (Fardo c/12)', brand:'Coca-Cola', size:'200ml', flavor:'Zero', price:19.80, cat:'bebidas', unitType:'fardo', packQty:12},

      {id:406, name:'Coca-Cola 220ml lata', brand:'Coca-Cola', size:'220ml', price:2.15, cat:'bebidas', unitType:'unidade'},
      {id:407, name:'Coca-Cola Zero 220ml lata', brand:'Coca-Cola', size:'220ml', flavor:'Zero', price:2.15, cat:'bebidas', unitType:'unidade'},
      {id:408, name:'Coca-Cola 220ml lata (Fardo c/12)', brand:'Coca-Cola', size:'220ml', price:25.80, cat:'bebidas', unitType:'fardo', packQty:12},
      {id:409, name:'Coca-Cola Zero 220ml lata (Fardo c/12)', brand:'Coca-Cola', size:'220ml', flavor:'Zero', price:25.80, cat:'bebidas', unitType:'fardo', packQty:12},

      {id:410, name:'Fanta Laranja 220ml lata', brand:'Fanta', size:'220ml', flavor:'Laranja', price:1.99, cat:'bebidas', unitType:'unidade'},
      {id:411, name:'Fanta Uva 220ml lata', brand:'Fanta', size:'220ml', flavor:'Uva', price:1.99, cat:'bebidas', unitType:'unidade'},
      {id:412, name:'Fanta Laranja 220ml lata (Fardo c/6)', brand:'Fanta', size:'220ml', flavor:'Laranja', price:11.94, cat:'bebidas', unitType:'fardo', packQty:6},
      {id:413, name:'Fanta Uva 220ml lata (Fardo c/6)', brand:'Fanta', size:'220ml', flavor:'Uva', price:11.94, cat:'bebidas', unitType:'fardo', packQty:6},

      // Energéticos BALY (Bebidas)
      {id:501, name:'Energético BALY 473ml Morango', brand:'BALY', size:'473ml', flavor:'Morango', price:4.50, cat:'bebidas', unitType:'unidade'},
      {id:502, name:'Energético BALY 473ml Coco & Açaí', brand:'BALY', size:'473ml', flavor:'Coco & Açaí', price:4.50, cat:'bebidas', unitType:'unidade'},
      {id:503, name:'Energético BALY 473ml Maçã Verde', brand:'BALY', size:'473ml', flavor:'Maçã Verde', price:4.50, cat:'bebidas', unitType:'unidade'},
      {id:504, name:'Energético BALY 473ml Tropical', brand:'BALY', size:'473ml', flavor:'Tropical', price:4.50, cat:'bebidas', unitType:'unidade'},
      {id:505, name:'Energético BALY 473ml Cereja', brand:'BALY', size:'473ml', flavor:'Cereja', price:4.50, cat:'bebidas', unitType:'unidade'},
      {id:506, name:'Energético BALY 473ml Manga', brand:'BALY', size:'473ml', flavor:'Manga', price:4.50, cat:'bebidas', unitType:'unidade'},
      {id:507, name:'Energético BALY 473ml Tradicional', brand:'BALY', size:'473ml', flavor:'Tradicional', price:4.50, cat:'bebidas', unitType:'unidade'},
      {id:508, name:'Energético BALY 473ml Melancia', brand:'BALY', size:'473ml', flavor:'Melancia', price:4.50, cat:'bebidas', unitType:'unidade'},

      // Chocolates (Chocolate)
      {id:601, name:'Nestlé Suflair 50g', brand:'Nestlé', size:'50g', price:4.99, cat:'chocolate', unitType:'unidade'},
      {id:602, name:'Nestlé Suflair 50g (Caixa c/20)', brand:'Nestlé', size:'50g', price:99.50, cat:'chocolate', unitType:'fardo', packQty:20},
      {id:603, name:'Nestlé KitKat 41,5g', brand:'Nestlé', size:'41,5g', price:2.99, cat:'chocolate', unitType:'unidade'},
      {id:604, name:'Nestlé KitKat 41,5g (Caixa c/24)', brand:'Nestlé', size:'41,5g', price:71.75, cat:'chocolate', unitType:'fardo', packQty:24},
      {id:605, name:'Arcor Block 38g', brand:'Arcor', size:'38g', price:1.75, cat:'chocolate', unitType:'unidade'},
      {id:606, name:'Arcor Block 38g (Caixa c/20)', brand:'Arcor', size:'38g', price:32.50, cat:'chocolate', unitType:'fardo', packQty:20},

      // Paçocas (Bala/Amendoim)
      {id:701, name:'Paçoca Clamel Rolha (Caixa c/100)', brand:'Clamel', price:29.95, cat:'bala', unitType:'fardo', packQty:100},
      {id:702, name:'Paçoca Moreninha do Rio (Caixa c/50)', brand:'Moreninha do Rio', price:18.50, cat:'bala', unitType:'fardo', packQty:50},
      {id:703, name:'Paçoca Paçoquita (Caixa c/50)', brand:'Paçoquita', price:24.90, cat:'bala', unitType:'fardo', packQty:50},

      // Salgadinhos Fabitos (Salgadinhos)
      {id:801, name:'Fabitos Churrasco 60g', brand:'Fabitos', size:'60g', flavor:'Churrasco', price:1.65, cat:'salgadinho', unitType:'unidade'},
      {id:802, name:'Fabitos Cebola 60g', brand:'Fabitos', size:'60g', flavor:'Cebola', price:1.65, cat:'salgadinho', unitType:'unidade'},
      {id:803, name:'Fabitos Bacon 60g', brand:'Fabitos', size:'60g', flavor:'Bacon', price:1.65, cat:'salgadinho', unitType:'unidade'},
      {id:804, name:'Fabitos Presunto 60g', brand:'Fabitos', size:'60g', flavor:'Presunto', price:1.65, cat:'salgadinho', unitType:'unidade'},
      {id:805, name:'Fabitos Pizza 60g', brand:'Fabitos', size:'60g', flavor:'Pizza', price:1.65, cat:'salgadinho', unitType:'unidade'},
      {id:806, name:'Fabitos Queijo 60g', brand:'Fabitos', size:'60g', flavor:'Queijo', price:1.65, cat:'salgadinho', unitType:'unidade'}
    ];

    // calcular/preencher unitPrice
    PRODUCTS.forEach(p=>{
      p.unitPrice = (p.unitType === 'fardo' && p.packQty) ? +(p.price / p.packQty).toFixed(4) : p.price;
    });

    // ====== Estado e helpers ======
    const grid = document.getElementById('grid');
    const titleCat = document.getElementById('titulo-categoria');
    const result = document.getElementById('result');
    const brandsEl = document.getElementById('brands');
    const clearBrandLink = document.getElementById('clearBrand');
    const cartCount = document.getElementById('cartCount');
    const cartListEl = document.getElementById('cartList');
    const subtotalEl = document.getElementById('subtotal');

    let currentCat = 'bebidas';
    let currentBrand = null;
    let currentSort = 'none';

    function titleByCat(cat){
      switch(cat){
        case 'bebidas': return 'Bebidas';
        case 'chiclete': return 'Chiclete';
        case 'bala': return 'Bala';
        case 'chocolate': return 'Chocolate';
        case 'bolacha': return 'Bolacha/Biscoito';
        case 'salgadinho': return 'Salgadinhos';
        case 'utilidades': return 'Utilidades';
        default: return 'Produtos';
      }
    }
    function formatBR(v){ return v.toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2}); }

    function cardHTML(p){
      const isFardo = p.unitType === 'fardo';
      const meta = [p.brand||'', p.size||'', p.flavor||''].filter(Boolean).join(' • ');
      return `
        <div class="card">
          <div class="thumb">
            FOTO
            ${isFardo ? `<span class="badge">${p.packQty ? ('FARDO c/'+p.packQty) : 'FARDO'}</span>`:''}
          </div>
          <div class="card-body">
            <div class="name">${p.name}</div>
            <div class="meta">${meta}</div>
            <div class="row">
              <span class="price">${isFardo ? 'Preço do fardo: ' : ''}R$ ${formatBR(p.price)}</span>
              <div class="qty">
                <button aria-label="Diminuir quantidade">-</button>
                <span data-qty="q${p.id}">1</span>
                <button aria-label="Aumentar quantidade">+</button>
              </div>
            </div>
            ${isFardo ? `<div class="unit">≈ R$ ${formatBR(p.unitPrice)} por unidade</div>`:''}
            <button class="btn primary add" data-add="${p.id}">Adicionar</button>
          </div>
        </div>
      `;
    }

    function updateClearBrandLink(){
      clearBrandLink.style.visibility = currentBrand ? 'visible' : 'hidden';
    }

    function filteredProducts(){
      return PRODUCTS.filter(p=>{
        const catOK = p.cat === currentCat;
        const brandOK = currentBrand ? (p.brand && p.brand.toLowerCase()===currentBrand.toLowerCase()) : true;
        return catOK && brandOK;
      });
    }

    function sortList(list, how){
      const arr = [...list];
      if(how==='price_asc') arr.sort((a,b)=>a.unitPrice - b.unitPrice);
      if(how==='price_desc') arr.sort((a,b)=>b.unitPrice - a.unitPrice);
      if(how==='name_asc') arr.sort((a,b)=>a.name.localeCompare(b.name,'pt-BR'));
      return arr;
    }

    function render(cat=currentCat){
      currentCat = cat;
      titleCat.textContent = titleByCat(cat);
      result.textContent = '';

      let items = filteredProducts();
      items = sortList(items, currentSort);

      if (!items.length) {
        grid.innerHTML = `
          <div style="grid-column:1/-1; padding:18px; text-align:center; border:1px solid var(--border); border-radius:12px;">
            Nenhum item em <b>${titleByCat(cat)}</b> ${currentBrand ? `para a marca <b>${currentBrand}</b>` : ''}.
          </div>`;
      } else {
        grid.innerHTML = items.map(cardHTML).join('');
      }

      // qty + adicionar
      grid.querySelectorAll('.card').forEach(card=>{
        const minus = card.querySelector('.qty button:first-child');
        const plus = card.querySelector('.qty button:last-child');
        const qty = card.querySelector('.qty span');
        let q = 1; const sync = ()=> qty.textContent = q;
        minus.addEventListener('click', ()=>{ q=Math.max(1,q-1); sync(); });
        plus.addEventListener('click', ()=>{ q=q+1; sync(); });
        card.querySelector('.add')?.addEventListener('click', ()=>{
          const name = card.querySelector('.name')?.textContent || 'Produto';
          const p = PRODUCTS.find(pp=>pp.name===name);
          if(p){ addToCart(p, q); drawerCart.classList.add('open'); }
        });
      });

      // ativar chip
      document.querySelectorAll('.chip').forEach(c=>{
        c.classList.toggle('active', c.dataset.cat===cat);
      });
    }

    // Inicial: 1ª categoria com itens
    (function initStartCategory(){
      const pref = ['bebidas','chiclete','bala','chocolate','bolacha','salgadinho','utilidades'];
      const first = pref.find(cat => PRODUCTS.some(p => p.cat===cat)) || 'bebidas';
      currentCat = first;
      document.querySelectorAll('.chip').forEach(c=>{
        c.classList.toggle('active', c.dataset.cat===first);
      });
      render(first);
    })();

    // Navegação pelas categorias
    document.getElementById('categories').addEventListener('click', (e)=>{
      const btn = e.target.closest('.chip');
      if(!btn) return;
      const cat = btn.dataset.cat;
      render(cat);
      grid.scrollIntoView({behavior:'smooth', block:'start'});
    });

    // Filtro por marca
    const brandsEl = document.getElementById('brands');
    brandsEl.addEventListener('click', (e)=>{
      const b = e.target.closest('.brand-card');
      if(!b) return;
      currentBrand = b.dataset.brand;
      brandsEl.querySelectorAll('.brand-card').forEach(x=> x.classList.toggle('active', x===b));
      updateClearBrandLink();
      render();
    });
    const clearBrandLink = document.getElementById('clearBrand');
    clearBrandLink.addEventListener('click', (e)=>{
      e.preventDefault();
      currentBrand = null;
      brandsEl.querySelectorAll('.brand-card').forEach(x=> x.classList.remove('active'));
      updateClearBrandLink();
      render();
    });
    updateClearBrandLink();

    // CEP mask
    const cep = document.getElementById('cep');
    cep.addEventListener('input', ()=>{
      let v = cep.value.replace(/\D/g,'').slice(0,8);
      if(v.length > 5) v = v.slice(0,5)+'-'+v.slice(5);
      cep.value = v;
    });

    // ====== Botões "Mais barato" ======
    function cheapest(arr){ if(!arr.length) return null; return arr.reduce((best,p)=> p.unitPrice<best.unitPrice?p:best, arr[0]); }
    function showResult(p, prefix='Mais barato:'){
      if(!p){ result.textContent = 'Nenhum item encontrado.'; return; }
      const unitTxt = p.unitType==='fardo' ? ` • ≈ R$ ${formatBR(p.unitPrice)} por un` : '';
      result.innerHTML = `<span class="success">${prefix}</span> ${p.name} — R$ ${formatBR(p.price)}${unitTxt}`;
      // trocar categoria/focar card
      render(p.cat);
      const card = [...grid.querySelectorAll('.card')].find(el=> el.querySelector('.name')?.textContent === p.name);
      if(card) card.scrollIntoView({behavior:'smooth', block:'center'});
    }
    document.getElementById('btn-cheapest-cat').addEventListener('click', ()=>{
      const p = cheapest(filteredProducts());
      showResult(p, `Mais barato em ${titleByCat(currentCat)}:`);
    });
    document.getElementById('btn-cheapest-global').addEventListener('click', ()=>{
      const p = cheapest(PRODUCTS);
      showResult(p, 'Item mais barato da loja:');
    });
    document.getElementById('btn-cheapest-pacoca').addEventListener('click', ()=>{
      const pacocas = PRODUCTS.filter(p=> /paçoca/i.test(p.name));
      const p = cheapest(pacocas);
      showResult(p, 'Paçoca mais barata:');
    });

    // ====== Carrinho (com localStorage)
    const CART_KEY = 'du_cart_v1';
    let cart = loadCart();

    function loadCart(){
      try { return JSON.parse(localStorage.getItem(CART_KEY)) || []; }
      catch(e){ return []; }
    }
    function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }

    function addToCart(product, qty=1){
      const i = cart.findIndex(it=> it.id===product.id);
      if(i>-1){ cart[i].qty += qty; }
      else{
        cart.push({
          id: product.id,
          name: product.name,
          brand: product.brand || '',
          unitType: product.unitType,
          packQty: product.packQty || 1,
          unitPrice: product.unitPrice,
          price: product.price,
          cat: product.cat,
          size: product.size || '',
          flavor: product.flavor || '',
          qty
        });
      }
      saveCart();
      renderCart();
    }
    function removeFromCart(id){ cart = cart.filter(it=> it.id!==id); saveCart(); renderCart(); }
    function changeQty(id, delta){
      const it = cart.find(x=> x.id===id); if(!it) return;
      it.qty = Math.max(1, it.qty + delta);
      saveCart(); renderCart();
    }
    function cartSubtotal(){ return cart.reduce((acc, it)=> acc + (it.price * it.qty), 0); }
    function renderCart(){
      cartCount.textContent = cart.length ? `(${cart.length})` : '';
      if(!cart.length){
        cartListEl.innerHTML = `<div class="cart-empty">Seu carrinho está vazio.</div>`;
        subtotalEl.textContent = '0,00';
        return;
      }
      cartListEl.innerHTML = cart.map(it=>{
        const meta = [it.brand, it.size, it.flavor].filter(Boolean).join(' • ');
        const perUnit = it.unitType==='fardo' ? `<div class="hint">≈ R$ ${formatBR(it.unitPrice)} / un</div>` : '';
        return `
          <div class="cart-item">
            <div style="width:48px;height:48px;background:var(--chip);border:1px solid var(--border);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:11px;color:var(--muted)">FOTO</div>
            <div>
              <div class="cart-name">${it.name}</div>
              <div class="cart-meta">${meta}</div>
              ${perUnit}
            </div>
            <div style="text-align:right">
              <div><b>R$ ${formatBR(it.price)}</b></div>
              <div class="cart-controls" style="justify-content:flex-end;margin-top:6px">
                <button aria-label="Diminuir" onclick="window.changeQty(${it.id},-1)">-</button>
                <span>${it.qty}</span>
                <button aria-label="Aumentar" onclick="window.changeQty(${it.id},1)">+</button>
                <button class="btn" style="padding:4px 8px" onclick="window.removeFromCart(${it.id})">Remover</button>
              </div>
            </div>
          </div>
        `;
      }).join('');
      subtotalEl.textContent = formatBR(cartSubtotal());
    }
    window.changeQty = changeQty;
    window.removeFromCart = removeFromCart;

    document.getElementById('clearCart').addEventListener('click', ()=>{
      if(confirm('Limpar o carrinho?')){
        cart = []; saveCart(); renderCart();
      }
    });

    document.getElementById('checkout').addEventListener('click', ()=>{
      alert('Checkout: em breve conectamos com seu backend/pagamento. Subtotal: R$ ' + formatBR(cartSubtotal()));
    });

    // Inicializações finais
    renderCart();
  </script>

  <noscript>Ative o JavaScript para usar nosso site e o atendimento por IA.</noscript>
</body>
</html>
